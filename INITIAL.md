## 功能：
这是一个用于 ANSYS CFX 在 HPC 集群上进行批量计算任务管理的完整自动化系统。功能包括：

1. **CFX 环境检测**
   - 检查服务器 CFX 安装是否存在（cfx5pre 和 cfx5solve），自动配置服务器CFX/bin地址
   - 根据 `cfx_mode` 配置：
     - `local`：同时检测本地 CFX 安装，自动配置本地CFX/bin的地址
     - `server`：仅检测服务器 CFX 安装。

2. **.pre 脚本批量生成 .def 文件**
   - 根据用户自定义的 `.pre.j2` 模板动态渲染参数（如压力、边界条件等）。
   - local 模式：在本地调用 `cfx5pre.exe` 生成 `.def` 文件，然后上传至服务器。
   - server 模式：先上传 `.cfx/.pre` 文件至服务器，在服务器调用 `cfx5pre` 生成 `.def` 文件。

3. **集群类型选择**
   - 用户可选择：
     - **学校集群**（SLURM）：直接生成作业脚本，无需节点分配。
     - **组内新集群**（SLURM）：节点查询 + 智能节点分配。
     - **组内老集群**（PBS）：节点查询 + 智能节点分配。

4. **节点查询与智能节点分配**
   - 实时查询节点状态（CPU 核心数、内存、可用性）。
   - 4 种智能调度策略：
     - batch_allocation
     - node_reuse
     - smart_queue
     - hybrid（默认推荐）

5. **作业脚本和批量提交脚本生成**
   - 根据集群类型自动生成 PBS/SLURM 作业脚本。
   - 使用 Jinja2 模板渲染，支持用户自定义。
   - 生成批量提交脚本（Submit_All.sh）和监控脚本（Monitor_Jobs.sh）。

6. **文件上传**
   - 上传 .def 文件（local 模式）或 .cfx/.pre 文件（server 模式）、作业脚本和提交脚本至服务器指定目录。
   - 支持断点续传、重试机制和完整性校验。

7. **作业提交**
   - 在服务器上执行批量提交脚本，将作业提交到 PBS/SLURM 队列。

8. **作业监控与结果管理**
   - 实时监控作业状态（排队/运行/完成/失败）。
   - 自动下载结果文件（.res、.out、.log 等）到本地目录。
   - 生成 JSON 格式的监控报告。
   - 可选择是否清理服务器端结果文件。

---

## 示例：
| 文件名                              | 用途说明                                           |
|-------------------------------------|---------------------------------------------------|
| `templates/create_def.pre.j2`       | .pre 脚本模板，支持用户自定义参数渲染。             |
| `templates/CFX_University.slurm.j2` | 学校集群 SLURM 作业脚本模板。                       |
| `templates/CFX_Group_PBS.pbs.j2`    | 组内老集群 PBS 作业脚本模板。                       |
| `example_jobs_simple.json`          | 演示 .pre 脚本生成 .def 文件的作业配置示例。          |
| `Submit_All.sh.j2`                  | .sh脚本模板，用于服务器批量上传作业                   |

---

## 文档链接：
- 参考集群指南文件夹中的全部内容，里面有集群的使用指南与作业提交脚本的示例
- pre文件夹中有生成.def的CFX-Pre session脚本示例

---

## 其他注意事项：
- **cfx_mode 控制 .def 生成位置**  
  - local：本地生成 .def → 上传服务器 → 服务器计算。
  - server：上传 .cfx/.pre → 服务器生成 .def → 服务器计算。

- **服务器 CFX 工具链检测** 是必做步骤。

- **.pre 脚本模板完全支持用户自定义**，可覆盖默认模板。

- **跨平台兼容性**：处理 Windows（本地）与 Linux（服务器）路径差异。

- **容错机制**：支持断点续算、网络异常重试。

