# CLAUDE.md

## 📖 项目感知能力

- AI 必须理解并遵循 **INITIAL.md** 中定义的项目规划文档和任务清单。  
- 在开发过程中需感知各模块间的依赖关系，合理安排功能实现顺序（检查 CFX 环境 → .pre 生成 → 集群调度 → 作业脚本生成 → 文件上传 → 提交作业 → 监控与结果下载）。  
- 支持对现有功能进行增量开发、模块拆分与优化，不得破坏已实现功能。

---

## 🗂️ 代码结构约束

- **模块拆分：**
  - 每个功能模块必须独立封装（如：`cfx.py`、`allocation.py`、`transfer.py`）。
  - 公共工具函数应放在 `utils/` 子目录内。
  - 配置管理单独放在 `config.py`，避免逻辑与配置耦合。

- **文件大小限制：**
  - 单个模块文件 ≤ **500 行代码**，必要时进一步拆分子模块。

- **命名规范：**
  - 文件和目录使用 **小写字母+下划线** 风格（如 `job_monitor.py`）。
  - 类名采用 **驼峰式命名**（如 `ClusterManager`）。
  - 函数与变量采用 **小写+下划线** 风格（如 `generate_def_files`）。

---

## ✅ 测试要求

- **单元测试覆盖：**
  - 每个模块必须包含至少 **80% 的代码覆盖率**。
  - 单元测试文件存放在 `tests/` 目录，命名规则：`test_<模块名>.py`。

- **测试框架：**
  - 使用 **pytest** 作为主要测试框架。

- **测试范围：**
  - 核心逻辑、配置加载、文件上传下载、异常处理均需覆盖。
  - 集成测试验证完整流程从环境检测到结果监控。

- **Mock 要求：**
  - 服务器交互（SSH、文件传输）和外部命令调用（如 `cfx5pre.exe`）必须进行 Mock，避免真实执行。

---

## 📝 编码风格

- **语言偏好：**
  - 使用 **Python 3.8+**，遵循 PEP8 编码规范。

- **格式规范：**
  - 每行代码长度 ≤ **100 字符**。
  - 函数必须包含类型注解（Type Hints）。
  - 所有模块需开启 **严格 lint 检查**（使用 flake8 / pylint）。

- **错误处理：**
  - 所有异常均需封装为自定义异常类并统一处理。
  - 网络/IO 操作应包含重试逻辑和超时机制。

- **日志记录：**
  - 使用 Python 内置 **logging** 模块，支持 DEBUG/INFO/WARNING/ERROR 四级日志。

---

## 📄 文档规范

- **代码注释：**
  - 使用 **Google 风格** docstring 格式。
  - 每个模块、类和方法必须编写文档注释，描述输入、输出、异常。

- **开发文档：**
  - 核心模块应配套简要的模块说明文档，存放在 `docs/` 目录。

- **README 更新：**
  - 修改功能时，需同步更新 `README.md` 和配置样例。

- **配置文件规范：**
  - 支持 YAML/JSON 格式配置。
  - 提供完整的参数说明文档（自动生成 `COMPLETE_PARAMETERS_LIST.md`）。

---

## 🪄 其他约束

- AI 生成的代码应 **易读、易维护**，禁止引入未经批准的外部依赖库。
- 所有 shell 脚本（如批量提交作业脚本）需明确平台兼容性（Linux）。
- 作业监控模块应支持 **断点续算** 和 **异常恢复**。

---

## 🚀 约定总结

- 模块化设计：每个功能独立开发，支持复用和扩展。
- 测试驱动开发：先定义接口和测试，再实现逻辑。
- 文档齐全：所有功能应配套注释和开发说明。

